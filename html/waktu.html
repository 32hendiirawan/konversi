<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>EduWaktu - Alat & Latihan Terarah</title>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <a class="tab-btn" href="konversi.html" style="text-decoration: none;">üè† Home</a>
        <button class="tab-btn active" onclick="openTab('belajar')">Materi</button>
        <button class="tab-btn" onclick="openTab('konverter')">Alat</button>
        <button class="tab-btn" onclick="openTab('latihan')">Latihan</button>
    </div>

    <div class="content">
        <div id="belajar" class="tab-content active">
            <img src="../png/waktu.png" alt="Tangga Satuan Waktu" style="width:100%; margin-bottom:10px;">
        </div>

        <div id="konverter" class="tab-content">
            <div class="helper-text">Input :</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center; margin-bottom:10px;">
                <input type="text" id="conv-val" class="input-box active" readonly onclick="setActiveInput('conv-val')" placeholder="0">
                <select id="cFrom" onchange="doConv()" style="flex:1"></select>
            </div>
            <div class="helper-text">Output :</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-items:center; margin-bottom:10px;">
                <div id="cRes" style="text-align:center; font-size:1.2rem; font-weight:bold; color:var(--primary); margin: 10px 0;">0</div>
                <select id="cTo" onchange="doConv()" style="flex:1"></select>
            </div>
            <div id="numpad-conv" class="numpad"></div>
        </div>

        <div id="latihan" class="tab-content">
            <div id="quiz-menu">
                <h3 style="text-align:center">Pilih Mode Latihan</h3>
                <button class="num-btn" style="width:100%; margin-bottom:10px;" onclick="initQuiz('kalender')">üìÖ Abad - Hari</button>
                <button class="num-btn" style="width:100%;" onclick="initQuiz('jam')">üïí Jam - Detik</button>
            </div>

            <div id="quiz-box" style="display:none;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span id="q-idx">Soal 1/10</span>
                    <span id="q-score">Skor: 0</span>
                </div>
                <div id="q-text" style="font-size:1.3rem; text-align:center; margin:20px 0; font-weight:bold; color:var(--primary);"></div>
                <input type="text" id="ans-f" class="input-box" readonly placeholder="Jawaban" onclick="setActiveInput('ans-f')">
                <div id="numpad-quiz" class="numpad"></div>
            </div>

            <div id="quiz-end" style="display:none; text-align:center;">
                <h3>Selesai! Skor: <span id="final-score"></span></h3>
                <div id="history-list" style="max-height:250px; overflow-y:auto; border:1px solid #eee; border-radius:10px; margin-bottom:10px; text-align:left;"></div>
                <button class="num-btn btn-green" style="width:100%" onclick="location.reload()">Tutup</button>
            </div>
        </div>
    </div>
</div>

<script>
    const VAL = {
        'Abad': 3110400000, 'Windu': 248832000, 'Tahun': 31104000,
        'Bulan': 2592000, 'Minggu': 604800, 'Hari': 86400,
        'Jam': 3600, 'Menit': 60, 'Detik': 1
    };

    const routesKalender = [
        ['Abad', 'Tahun'], ['Windu', 'Tahun'], ['Tahun', 'Bulan'], 
        ['Bulan', 'Hari'], ['Minggu', 'Hari'],
    ];

    const routesJam = [
        ['Hari', 'Jam'], ['Jam', 'Menit'], ['Menit', 'Detik'], ['Jam', 'Detik']
    ];

    let activeInputId = 'conv-val';
    let curQ = 0, score = 0, quizCat = '', qData = {}, history = [];

    // --- SETUP UI ---
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
        if(id === 'konverter') setActiveInput('conv-val');
    }

    function setActiveInput(id) {
        activeInputId = id;
        document.querySelectorAll('.input-box').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- LOGIKA KONVERTER ---
    const sf = document.getElementById('cFrom'), st = document.getElementById('cTo');
    Object.keys(VAL).forEach(k => { 
        sf.add(new Option(k, VAL[k])); 
        st.add(new Option(k, VAL[k])); 
    });
    st.selectedIndex = 6; // Default ke Jam

    function doConv() {
        const v = parseFloat(document.getElementById('conv-val').value);
        if(isNaN(v)) { document.getElementById('cRes').innerText = "0"; return; }
        const res = (v * sf.value) / st.value;
        document.getElementById('cRes').innerText = `${Number(res.toFixed(2))}`;
    }

    // --- LOGIKA LATIHAN ---
    function initQuiz(cat) {
        quizCat = cat; curQ = 0; score = 0;
        document.getElementById('quiz-menu').style.display = 'none';
        document.getElementById('quiz-box').style.display = 'block';
        renderNumpad('numpad-quiz', true);
        genQ();
    }

    function genQ() {
        if(curQ >= 10) return showEnd();
        curQ++;
        document.getElementById('q-idx').innerText = `Soal ${curQ}/10`;
        document.getElementById('ans-f').value = '';
        
        const pool = (quizCat === 'kalender') ? routesKalender : routesJam;
        const route = pool[Math.floor(Math.random() * pool.length)];
        
        const isForward = Math.random() > 0.3;
        const unitFrom = isForward ? route[0] : route[1];
        const unitTo = isForward ? route[1] : route[0];

        let val;
        if(isForward) {
            val = Math.floor(Math.random() * 5) + 1;
        } else {
            const ratio = VAL[unitTo] / VAL[unitFrom];
            val = (Math.floor(Math.random() * 3) + 1) * ratio;
        }

        qData = { 
            text: `${val} ${unitFrom} = ... ${unitTo}`, 
            target: Number(((val * VAL[unitFrom]) / VAL[unitTo]).toFixed(1)) 
        };
        document.getElementById('q-text').innerText = qData.text;
        setActiveInput('ans-f');
    }

    function submitAns() {
        const input = document.getElementById('ans-f').value;
        if(input === "") return;
        const f = parseFloat(input);
        const isOk = Math.abs(f - qData.target) < 0.1;
        if(isOk) score++;
        history.push({ q: qData.text, ok: isOk, t: qData.target });
        document.getElementById('q-score').innerText = `Skor: ${score*10}`;
        genQ();
    }

    // --- NUMPAD ---
    function renderNumpad(containerId, isQuiz = false) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        ['1','2','3','4','5','6','7','8','9','.', '0', 'DEL'].forEach(key => {
            const btn = document.createElement('button');
            btn.className = 'num-btn' + (key === 'DEL' ? ' btn-red' : '');
            btn.innerText = key === 'DEL' ? '‚å´' : key;
            btn.onclick = () => {
                const input = document.getElementById(activeInputId);
                if(key === 'DEL') input.value = input.value.slice(0, -1);
                else if(key === '.' && input.value.includes('.')) return;
                else input.value += key;
                if(activeInputId === 'conv-val') doConv();
            };
            container.appendChild(btn);
        });
        if(isQuiz) {
            const sBtn = document.createElement('button');
            sBtn.className = 'num-btn btn-green';
            sBtn.innerText = 'JAWAB';
            sBtn.onclick = submitAns;
            container.appendChild(sBtn);
        }
    }

    function showEnd() {
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('quiz-end').style.display = 'block';
        document.getElementById('final-score').innerText = score * 10;
        document.getElementById('history-list').innerHTML = history.map(h => `
            <div style="padding:8px; border-bottom:1px solid #eee; font-size:0.85rem">
                <b>${h.q}</b> <span style="color:${h.ok?'green':'red'}">${h.ok?'(B)':'(S, Kunci: '+h.t+')'}</span>
            </div>
        `).join('');
    }

    renderNumpad('numpad-conv');
</script>
</body>
</html>