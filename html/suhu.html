<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>EduSuhu Fix - Evaluasi Muncul</title>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <a class="tab-btn" href="konversi.html" style="text-decoration: none;">üè† Home</a>
        <button class="tab-btn" onclick="openTab('belajar')">Materi</button>
        <button class="tab-btn active" onclick="openTab('konverter')">Alat</button>
        <button class="tab-btn" onclick="openTab('latihan')">Latihan</button>
    </div>

    <div class="content">
        <div id="belajar" class="tab-content active">
            <img src="../png/suhu.png" alt="Materi Suhu" style="width:100%; height:auto;"> 
        </div>

        <div id="konverter" class="tab-content">
            <div class="helper-text">Nilai:</div>
            <input type="text" id="conv-val" class="input-box active" readonly onclick="setActiveInput('conv-val')" placeholder="0">
            <div style="display:flex; gap:10px;">
                <select id="cFrom" onchange="doConv()" style="flex:1"></select>
                <select id="cTo" onchange="doConv()" style="flex:1"></select>
            </div>
            <div id="cRes" style="text-align:center; font-size:1.5rem; font-weight:bold; color:var(--primary); margin: 20px 0;">Hasil: -</div>
            <div id="numpad-conv" class="numpad"></div>
        </div>

        <div id="latihan" class="tab-content">
            <div id="quiz-start" style="text-align:center; padding-top: 20px;">
                <button class="num-btn" style="width:100%; margin-bottom:15px;" onclick="initQuiz()">MULAI LATIHAN</button>
            </div>

            <div id="quiz-box" style="display:none;">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span id="q-idx">Soal 1/10</span>
                    <span id="q-score" style="color:var(--success)">Skor: 0</span>
                </div>
                <div id="q-text" style="font-size:1.2rem; text-align:center; margin:20px 0; font-weight:bold; color:var(--primary);"></div>
                <input type="text" id="ans-f" class="input-box" readonly placeholder="Jawaban" onclick="setActiveInput('ans-f')">
                <div id="numpad-quiz" class="numpad"></div>
            </div>

            <div id="quiz-end" style="display:none; text-align:center;">
                <h3>Hasil Evaluasi</h3>
                <h1 id="final-score-display" style="color:var(--primary); margin-bottom:10px;">0</h1>
                <div id="history-list-suhu" style="max-height:300px; overflow-y:auto; border:1px solid #ddd; padding:10px; background:#f9f9f9; text-align:left; border-radius:10px;"></div>
                <button class="num-btn btn-green" style="width:100%; margin-top:15px;" onclick="location.reload()">Main Lagi</button>
            </div>
        </div>
    </div>
</div>

<script>
    const units = ['Celcius', 'Reamur', 'Fahrenheit', 'Kelvin'];
    let activeInputId = 'conv-val';
    let curQ = 0, score = 0, qData = {}, historySuhu = [];

    // --- SETUP ---
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
        if(id === 'konverter') renderNumpad('numpad-conv', false);
    }

    function setActiveInput(id) {
        activeInputId = id;
        document.querySelectorAll('.input-box').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- LOGIKA SUHU ---
    function convertTemp(val, from, to) {
        let c;
        if (from === 'Celcius') c = val;
        else if (from === 'Reamur') c = val * 5 / 4;
        else if (from === 'Fahrenheit') c = (val - 32) * 5 / 9;
        else if (from === 'Kelvin') c = val - 273;

        let res;
        if (to === 'Celcius') res = c;
        else if (to === 'Reamur') res = c * 4 / 5;
        else if (to === 'Fahrenheit') res = c * 9 / 5 + 32;
        else if (to === 'Kelvin') res = c + 273;
        return Math.round(res * 10) / 10;
    }

    // Generator Angka Pintar (Selalu Bulat)
    function getSmartValue(unit) {
        let base = Math.floor(Math.random() * 25) - 5; 
        if (unit === 'Celcius') return base * 5;
        if (unit === 'Reamur') return base * 4;
        if (unit === 'Fahrenheit') return (base * 9) + 32;
        if (unit === 'Kelvin') return (base * 5) + 273;
        return base;
    }

    const sf = document.getElementById('cFrom'), st = document.getElementById('cTo');
    units.forEach(u => { sf.add(new Option(u, u)); st.add(new Option(u, u)); });
    st.selectedIndex = 1;

    function doConv() {
        const v = parseFloat(document.getElementById('conv-val').value);
        if(isNaN(v)) { document.getElementById('cRes').innerText = "Hasil: -"; return; }
        const res = convertTemp(v, sf.value, st.value);
        document.getElementById('cRes').innerText = `Hasil: ${res} ¬∞${st.value[0]}`;
    }

    // --- LATIHAN ---
    function initQuiz() {
        curQ = 0; score = 0; historySuhu = [];
        document.getElementById('quiz-start').style.display = 'none';
        document.getElementById('quiz-box').style.display = 'block';
        setActiveInput('ans-f');
        renderNumpad('numpad-quiz', true);
        genQ();
    }

    function genQ() {
        if(curQ >= 10) return showEnd();
        curQ++;
        document.getElementById('q-idx').innerText = `Soal ${curQ}/10`;
        document.getElementById('ans-f').value = '';
        
        let fromIdx = Math.floor(Math.random() * 4);
        let toIdx; do { toIdx = Math.floor(Math.random() * 4); } while(fromIdx === toIdx);
        let uF = units[fromIdx], uT = units[toIdx];

        let val = getSmartValue(uF);
        qData = { 
            text: `${val}¬∞${uF[0]} = ... ¬∞${uT[0]}`, 
            target: convertTemp(val, uF, uT) 
        };
        document.getElementById('q-text').innerText = qData.text;
    }

    function submitAns() {
        const inputVal = document.getElementById('ans-f').value;
        if(inputVal === "") return;
        const f = parseFloat(inputVal);
        const isOk = Math.abs(f - qData.target) < 0.2;
        if(isOk) score++;
        
        historySuhu.push({ q: qData.text, ok: isOk, t: qData.target, user: f });
        document.getElementById('q-score').innerText = `Skor: ${score*10}`;
        genQ();
    }

    function showEnd() {
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('quiz-end').style.display = 'block';
        document.getElementById('final-score-display').innerText = score * 10;
        
        const listContainer = document.getElementById('history-list-suhu');
        listContainer.innerHTML = historySuhu.map(h => `
            <div class="history-item">
                <b>${h.q}</b><br>
                <span>Jawaban: ${h.user}</span> 
                <span class="${h.ok?'correct':'wrong'}">
                    ${h.ok ? '‚úî Benar' : '‚úò Salah (Kunci: ' + h.t + ')'}
                </span>
            </div>
        `).join('');
    }

    function renderNumpad(containerId, isQuiz) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        const keys = ['1','2','3','4','5','6','7','8','9','-','0','DEL'];
        keys.forEach(key => {
            const btn = document.createElement('button');
            btn.className = 'num-btn' + (key === 'DEL' ? ' btn-red' : (key === '-' ? ' btn-neg' : ''));
            btn.innerText = key === 'DEL' ? '‚å´' : key;
            btn.onclick = () => {
                const input = document.getElementById(activeInputId);
                if(key === 'DEL') input.value = input.value.slice(0, -1);
                else if(key === '-') {
                    if(input.value.startsWith('-')) input.value = input.value.substring(1);
                    else input.value = '-' + input.value;
                }
                else input.value += key;
                if(activeInputId === 'conv-val') doConv();
            };
            container.appendChild(btn);
        });
        if(isQuiz) {
            const sBtn = document.createElement('button');
            sBtn.className = 'num-btn btn-green';
            sBtn.innerText = 'JAWAB';
            sBtn.onclick = submitAns;
            container.appendChild(sBtn);
        }
    }

    // Jalankan numpad awal
    renderNumpad('numpad-conv', false);
</script>
</body>
</html>