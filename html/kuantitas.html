<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>EduKuantitas - Rim, Gross, Kodi, Lusin</title>
</head>
<body>

<div class="container">
    <div class="nav-tabs">
        <a class="tab-btn" href="konversi.html" style="text-decoration: none;">üè† Home</a>
        <button class="tab-btn active" onclick="openTab('belajar')">Materi</button>
        <button class="tab-btn" onclick="openTab('konverter')">Alat</button>
        <button class="tab-btn" onclick="openTab('latihan')">Latihan</button>
    </div>

    <div class="content">
        <div id="belajar" class="tab-content active">
            <img src="../png/kuantitas.png" alt="Tangga Satuan Kuantitas" style="width:100%; margin-bottom:10px;"> 
        </div>

        <div id="konverter" class="tab-content">
            <div style="text-align:center; font-weight:bold; color:#64748b; margin-bottom:5px;">Jumlah:</div>
            <input type="text" id="conv-val" class="input-box active" readonly onclick="setActiveInput('conv-val')" placeholder="0">
            <div style="display:flex; gap:10px;">
                <select id="cFrom" onchange="doConv()"></select>
                <select id="cTo" onchange="doConv()"></select>
            </div>
            <div id="cRes" style="text-align:center; font-size:1.6rem; font-weight:bold; color:var(--primary); margin: 20px 0;">Hasil: -</div>
            <div id="numpad-conv" class="numpad"></div>
        </div>

        <div id="latihan" class="tab-content">
            <div id="quiz-box">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.9rem">
                    <span id="q-idx">Soal 1/10</span>
                    <span id="q-score" style="color:var(--success);">Skor: 0</span>
                </div>
                <div id="q-text" style="font-size:1.3rem; text-align:center; margin:25px 0; font-weight:bold; color:var(--primary);"></div>
                <input type="text" id="ans-f" class="input-box" readonly placeholder="Jawaban" onclick="setActiveInput('ans-f')">
                <div id="numpad-quiz" class="numpad"></div>
            </div>

            <div id="quiz-end" style="display:none; text-align:center;">
                <h3>Selesai!</h3>
                <h1 style="color:var(--primary); margin:0;">Skor: <span id="final-score">0</span></h1>
                <div id="history-list" style="max-height:300px; overflow-y:auto; border:1px solid #eee; border-radius:10px; margin:15px 0; text-align:left; background:#fafafa;"></div>
                <button class="num-btn btn-green" style="width:100%" onclick="location.reload()">Tutup</button>
            </div>
        </div>
    </div>
</div>

<script>
    const VAL = {
        'Gross': 144, 'Rim': 500, 'Kodi': 20, 'Lusin': 12, 'Buah': 1
    };

    let activeInputId = 'conv-val';
    let curQ = 0, score = 0, qData = {}, historyData = [];

    // TABS
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
        if(id === 'konverter') setActiveInput('conv-val');
        if(id === 'latihan' && curQ === 0) genQ();
    }

    function setActiveInput(id) {
        activeInputId = id;
        document.querySelectorAll('.input-box').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // KONVERTER
    const sf = document.getElementById('cFrom'), st = document.getElementById('cTo');
    Object.keys(VAL).forEach(k => { 
        sf.add(new Option(k, VAL[k])); 
        st.add(new Option(k, VAL[k])); 
    });
    st.selectedIndex = 4; // Default ke Buah

    function doConv() {
        const v = parseFloat(document.getElementById('conv-val').value);
        if(isNaN(v)) { document.getElementById('cRes').innerText = "Hasil: -"; return; }
        const res = (v * sf.value) / st.value;
        document.getElementById('cRes').innerText = `Hasil: ${Number(res.toFixed(2))} ${st.options[st.selectedIndex].text}`;
    }

    // LATIHAN (Anti-Pecahan Logic)
    function genQ() {
        if(curQ >= 10) return showEnd();
        curQ++;
        document.getElementById('q-idx').innerText = `Soal ${curQ}/10`;
        document.getElementById('ans-f').value = '';
        
        const units = Object.keys(VAL);
        let fromIdx = Math.floor(Math.random() * units.length);
        let toIdx; do { toIdx = Math.floor(Math.random() * units.length); } while(fromIdx === toIdx);
        
        let uF = units[fromIdx], uT = units[toIdx];
        let val;

        // Logika agar tidak pecahan:
        // Jika dari satuan kecil ke besar (misal Buah ke Kodi), 
        // angka soal harus kelipatan satuan tujuan.
        if (VAL[uF] < VAL[uT]) {
            val = (Math.floor(Math.random() * 5) + 1) * VAL[uT];
            // Khusus Rim, jangan terlalu besar angkanya
            if (uT === 'Rim') val = (Math.floor(Math.random() * 3) + 1) * 500;
        } else {
            // Jika dari besar ke kecil (misal Gross ke Buah), angka bebas saja
            val = Math.floor(Math.random() * 10) + 1;
        }

        qData = { 
            text: `${val} ${uF} = ... ${uT}`, 
            target: (val * VAL[uF]) / VAL[uT] 
        };
        document.getElementById('q-text').innerText = qData.text;
    }

    function submitAns() {
        const inputVal = document.getElementById('ans-f').value;
        if(inputVal === "") return;
        const ans = parseFloat(inputVal);
        const ok = Math.abs(ans - qData.target) < 0.01;
        if(ok) score++;
        
        historyData.push({ q: qData.text, ok: ok, t: qData.target, u: ans });
        document.getElementById('q-score').innerText = `Skor: ${score*10}`;
        genQ();
    }

    function showEnd() {
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('quiz-end').style.display = 'block';
        document.getElementById('final-score').innerText = score * 10;
        document.getElementById('history-list').innerHTML = historyData.map(h => `
            <div class="history-item">
                <b>${h.q}</b><br>
                <span>Anda: ${h.u}</span> | <span style="color:${h.ok?'green':'red'}">${h.ok?'Benar':'Salah (Kunci: '+h.t+')'}</span>
            </div>
        `).join('');
    }

    // NUMPAD
    function renderNumpad(containerId, isQuiz) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        ['1','2','3','4','5','6','7','8','9','.','0','DEL'].forEach(key => {
            const btn = document.createElement('button');
            btn.className = 'num-btn' + (key === 'DEL' ? ' btn-red' : '');
            btn.innerText = key === 'DEL' ? '‚å´' : key;
            btn.onclick = () => {
                const input = document.getElementById(activeInputId);
                if(key === 'DEL') input.value = input.value.slice(0, -1);
                else input.value += key;
                if(activeInputId === 'conv-val') doConv();
            };
            container.appendChild(btn);
        });
        if(isQuiz) {
            const sBtn = document.createElement('button');
            sBtn.className = 'num-btn btn-green';
            sBtn.innerText = 'JAWAB';
            sBtn.onclick = submitAns;
            container.appendChild(sBtn);
        }
    }

    renderNumpad('numpad-conv', false);
    renderNumpad('numpad-quiz', true);
</script>
</body>
</html>